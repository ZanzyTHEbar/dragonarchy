#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck source=lib/theme-utils.sh
source "$SCRIPT_DIR/lib/theme-utils.sh"

for theme in "$THEMES_DIR"/*/; do
    palette="$theme/hyprland-palette.conf"
    [[ -f "$palette" ]] || continue
    
    background="$(tm_palette_hex "$palette" background)" || continue
    foreground="$(tm_palette_hex "$palette" foreground "$background")"
    comment="$(tm_palette_hex "$palette" comment "$foreground")"
    accent="$(tm_palette_hex "$palette" accent "$foreground")"
    red="$(tm_palette_hex "$palette" red "$accent")"
    green="$(tm_palette_hex "$palette" green "$accent")"
    orange="$(tm_palette_hex "$palette" orange "$accent")"
    yellow="$(tm_palette_hex "$palette" yellow "$orange")"
    blue="$(tm_palette_hex "$palette" blue "$accent")"
    magenta="$(tm_palette_hex "$palette" magenta "$accent")"
    cyan="$(tm_palette_hex "$palette" cyan "$accent")"
    
    inactive_border="$(tm_hex_blend "$background" "$comment" 55)"
    active_border="$accent"
    
  cat >"${theme%/}/kitty.conf" <<EOF
# Auto-generated from hyprland-palette.conf. Do not edit by hand.
# Generated by scripts/theme-manager/generate-kitty-themes

foreground $foreground
background $background
cursor $accent
cursor_text_color $background
selection_background $accent
selection_foreground $background
url_color $accent

# Inline hints / autocomplete colors
shell_integration    enabled
shell               zsh
zsh_autosuggestion   $accent
url_style            none

active_border_color $active_border
inactive_border_color $inactive_border
bell_border_color $active_border

color0  $background
color1  $red
color2  $green
color3  $yellow
color4  $blue
color5  $magenta
color6  $cyan
color7  $foreground

color8  $comment
color9  $red
color10 $green
color11 $yellow
color12 $blue
color13 $magenta
color14 $cyan
color15 $foreground
EOF
    echo "Wrote ${theme}kitty.conf"
done