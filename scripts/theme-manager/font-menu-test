#!/bin/bash
# A script to select and set the terminal font for Alacritty and Kitty.

set -e

# --- Header and Logging ---
BLUE='\033[0;34m'
RED='\033[0;31m'
NC='\033[0m'

# --- Configuration ---
ALACRITTY_CONFIG="$HOME/.config/alacritty/missing.toml"
KITTY_CONFIG="$HOME/.config/kitty/kitty.conf.test"

log_info() {
  echo -e "\n${BLUE}[INFO]${NC} $1"
}

log_error() {
  echo -e "${RED}[ERROR]${NC} $1"
}

# --- Main Logic ---
log_info "Searching for available monospace fonts..."

# For testing purposes, use a hardcoded font instead of interactive selection
font="Hack"

if [[ -n "$font" ]]; then
  # Update Alacritty config
  if [ -f "$ALACRITTY_CONFIG" ]; then
    sed -i "s/family = \".*\"/family = \"$font\"/g" "$ALACRITTY_CONFIG"
    log_info "Alacritty font set to: $font"
  else
    log_error "Alacritty config file not found at: $ALACRITTY_CONFIG"
  fi

  # Update Kitty config
  if [ -f "$KITTY_CONFIG" ]; then
    # Use sed to replace or add the font_family line in Kitty config
    if grep -q "^font_family" "$KITTY_CONFIG"; then
      # If font_family line exists, replace it
      sed -i "s/^font_family.*/font_family $font/" "$KITTY_CONFIG"
    else
      # If font_family line doesn't exist, add it at the end
      echo "font_family $font" >>"$KITTY_CONFIG"
    fi
    log_info "Kitty font set to: $font"
  else
    log_error "Kitty config file not found at: $KITTY_CONFIG"
  fi
fi
