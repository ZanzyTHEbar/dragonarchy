#!/usr/bin/env bash
set -euo pipefail

if [[ $# -lt 1 ]]; then
  echo "Usage: theme-set-background <image-path>" >&2
  exit 1
fi

target="$1"

if [[ "$target" == "~/"* ]]; then
  target="${target/#\~/$HOME}"
fi

if [[ ! -f "$target" ]]; then
  echo "theme-set-background: file not found: $target" >&2
  exit 1
fi

link="${XDG_CONFIG_HOME:-$HOME/.config}/current/background"
mkdir -p "$(dirname "$link")"
ln -nsf "$target" "$link"

# Restart swaybg to apply the new background
pkill -x swaybg >/dev/null 2>&1 || true
setsid uwsm app -- swaybg -i "$link" -m fill >/dev/null 2>&1 &

if command -v notify-send >/dev/null 2>&1; then
  notify-send "Background Updated" "$(basename "$target")"
fi


