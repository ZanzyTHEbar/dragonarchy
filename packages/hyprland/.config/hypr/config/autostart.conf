# ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
# ┃                    Autostart Configuration                  ┃
# ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

source = ~/.config/hypr/config/defaults.conf

# Autostart wiki https://wiki.hyprland.org/0.45.0/Configuring/Keywords/#executing #

# Core Components
exec-once = uwsm app -- ~/.local/bin/theme-bg-apply &
exec-once = ~/.local/bin/thermal-profile-init &
exec-once = bash -lc 'command -v systemctl >/dev/null 2>&1 && systemctl --user start waybar-hoverd.service' &
exec-once = uwsm app -- fcitx5 &
exec-once = uwsm app -- swaync &
exec-once = uwsm app -- hypridle -c ~/.config/hypr/hypridle.conf &
exec-once = uwsm app -- swayosd-server &
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 &
exec-once = /usr/bin/gnome-keyring-daemon --start --components=pkcs11,secrets,ssh &

# System Tray
exec-once = nm-applet --indicator &

# Load Hyprland gesture plugins
# FIXME: This needs to be loaded per host
#exec-once = hyprctl plugin load ~/.local/share/hyprland-plugins/hyprgrass/build/src/libhyprgrass.so
# Load Hyprland plugins (gesture support)
#exec-once = ~/.config/hypr/scripts/load-gesture-plugins.sh &

# Volume/Brightness OSD (WOB)
# IMPORTANT: keybinds write to /tmp/$HYPRLAND_INSTANCE_SIGNATURE.wob.
# - Ensure we create a FIFO (not a regular file)
# - Avoid failing if wob isn't installed yet
exec-once = bash -lc 'if command -v wob >/dev/null 2>&1; then rm -f "/tmp/$HYPRLAND_INSTANCE_SIGNATURE.wob"; mkfifo -m 600 "/tmp/$HYPRLAND_INSTANCE_SIGNATURE.wob"; tail -f "/tmp/$HYPRLAND_INSTANCE_SIGNATURE.wob" | wob & disown; fi'

# Slow app launch fix: import env and ensure elephant restarts before walker service
exec-once = bash -lc '\
  command -v systemctl >/dev/null 2>&1 && timeout 2s systemctl --user import-environment >/dev/null 2>&1 || true; \
  command -v dbus-update-activation-environment >/dev/null 2>&1 && timeout 2s dbus-update-activation-environment --systemd --all >/dev/null 2>&1 || true; \
  command -v systemctl >/dev/null 2>&1 && timeout 2s systemctl --user restart elephant >/dev/null 2>&1 || true; \
' &
exec-once = uwsm app -- walker --gapplication-service

# Clipboard
exec-once = clipse -listen &
exec-once = wl-clip-persist --clipboard regular --all-mime-type-regex '^(?!x-kde-passwordManagerHint).+' &
